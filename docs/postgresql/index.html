<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Define automated SQL checks against your production databases and get proactive alerts when the data starts to look wrong."><meta name=author content="QueryCanary"><meta name=theme-color content="#ffffff" media="(prefers-color-scheme: light)"><meta name=theme-color content="#101010" media="(prefers-color-scheme: dark)"><title>Using PostgreSQL with QueryCanary · QueryCanary Docs</title>
<link rel=canonical href=/docs/postgresql/><link rel=stylesheet href=/assets/css/docs.min.8e9408609771a441499aa5571a4585b0ca95783b842d5c758af5eef1457b0fe0.css integrity><link rel=manifest href=/manifest.json><link rel=icon href=/favicon/favicon.ico><link rel=icon href=/favicon/favicon-16x16.png sizes=16x16 type=image/png><link rel=icon href=/favicon/favicon-32x32.png sizes=32x32 type=image/png><link rel=apple-touch-icon href=/favicon/apple-touch-icon.png sizes=180x180><script async src="https://www.googletagmanager.com/gtag/js?id=-"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","-")</script></head><body><div id=outer-wrapper><div id=aside-wrapper><aside><div><button class=btn><i>❌</i>Close</button></div><a href=/ class=site-logo>QueryCanary Docs</a><nav role=navigation><details open><summary>Documentation</summary><ul><li><a href=/docs/overview/>Overview</a></li></ul></details><details open><summary>Servers</summary><ul><li><a class=active href=/docs/postgresql/>PostgreSQL</a></li><li><a href=/docs/mysql/>MySQL</a></li><li><a href=/docs/clickhouse/>ClickHouse</a></li><li><a href=/docs/ssh-tunnel/>SSH Tunnel</a></li></ul></details></nav></aside></div><div id=content-wrapper><header><a href=/ class=site-logo>QueryCanary Docs</a></header><main><article><nav><button class=btn><i>⬅️</i> On this section</button>
<button class=btn>On this page <i>➡️</i></button></nav><header><h1>Using PostgreSQL with QueryCanary</h1><p></p></header><div id=article-body><p>QueryCanary fully supports PostgreSQL for production data monitoring. This guide walks you through connecting your database, writing SQL checks, and troubleshooting common issues.</p><h2 id=overview>Overview</h2><p>QueryCanary connects directly to your PostgreSQL database — with or without SSH tunneling — and allows you to define SQL checks to monitor important conditions in your data (e.g. low signups, null prices, broken joins).</p><p>You can:</p><ul><li>Run scheduled SQL queries on your prod database</li><li>Set expectations or anomaly detection on results</li><li>Receive alerts via email or Slack when something looks off</li></ul><h2 id=requirements>Requirements</h2><ul><li>PostgreSQL version 10 or higher</li><li>A read-only database user</li><li>Access via direct TCP or through an SSH tunnel</li></ul><p>We recommend connecting to a replica or using a read-only role for safety.</p><h2 id=setup>Setup</h2><h3 id=1-create-a-read-only-user>1. Create a Read-Only User</h3><p>In your Postgres server:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 1. Create a dedicated read-only user
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>USER</span><span class=w> </span><span class=n>querycanary_reader</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=n>PASSWORD</span><span class=w> </span><span class=s1>&#39;your_secure_password&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 2. Allow it to connect to your database
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>GRANT</span><span class=w> </span><span class=k>CONNECT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>your_database</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>querycanary_reader</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 3. Grant usage on the schema you want to monitor (typically public)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>GRANT</span><span class=w> </span><span class=k>USAGE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>SCHEMA</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>querycanary_reader</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 4. Grant read-only access to all existing tables
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>GRANT</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=n>TABLES</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=k>SCHEMA</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>querycanary_reader</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 5. Ensure access to future tables too
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>PRIVILEGES</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=k>SCHEMA</span><span class=w> </span><span class=k>public</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GRANT</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>TABLES</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>querycanary_reader</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=connecting-to-postgres>Connecting to Postgres</h2><h3 id=option-1-direct-connection>Option 1: Direct Connection</h3><p>Use this if your database is publicly accessible or hosted on a service like RDS, Supabase, or Fly.io.</p><p>You’ll need:</p><ul><li>Hostname (e.g. db.example.com)</li><li>Port (usually 5432)</li><li>Database name</li><li>Username & password</li></ul><h3 id=option-2-ssh-tunnel-recommended-for-private-networks>Option 2: SSH Tunnel (Recommended for Private Networks)</h3><p>Use this if your DB is in a private VPC and only accessible from a bastion host.</p><p>You’ll additionally need:</p><ul><li>Bastion host (hostname/IP)</li><li>SSH username</li><li>SSH public key (we generate one for you securely)</li></ul><p>QueryCanary connects via SSH, opens a secure tunnel, and connects to your internal Postgres instance.</p><h2 id=writing-sql-checks>Writing SQL Checks</h2><p>You can monitor anything you can query. Example:</p><p><strong>Daily Signups Check</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>created_at</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=k>CURRENT_DATE</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nb>INTERVAL</span><span class=w> </span><span class=s1>&#39;1 day&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p><strong>Broken Joins Check</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>user_id</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NULL</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=troubleshooting>Troubleshooting</h2><p><strong>Can&rsquo;t connect to database</strong></p><ul><li>Make sure the hostname and port are reachable</li><li>Check that the user has CONNECT and SELECT permissions</li><li>Confirm no VPN/firewall blocks our IP (contact support if needed)</li></ul><p><strong>SSH tunnel fails</strong></p><ul><li>Make sure your bastion host is reachable</li><li>Add the provided public key to ~/.ssh/authorized_keys on the bastion</li><li>Check that the bastion user can access the database internally</li></ul><p><strong>Query fails or returns empty</strong></p><ul><li>Test your query locally with psql or your app first</li><li>Avoid LIMIT, ORDER BY, or formatting functions — we only need values</li><li>Use COUNT, SUM, AVG, or conditional expressions to track value changes</li></ul></div><footer><time datetime=2025-05-28><i>🕒</i> Updated: 2025-05-28</time>
<a href=/docs/overview/><i>﹤</i> Previous</a>
<a href=/docs/mysql/>Next <i>﹥</i></a></footer></article><aside><div><button class=btn><i>❌</i>Close</button></div><strong>On this page</strong><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#setup>Setup</a><ul><li><a href=#1-create-a-read-only-user>1. Create a Read-Only User</a></li></ul></li><li><a href=#connecting-to-postgres>Connecting to Postgres</a><ul><li><a href=#option-1-direct-connection>Option 1: Direct Connection</a></li><li><a href=#option-2-ssh-tunnel-recommended-for-private-networks>Option 2: SSH Tunnel (Recommended for Private Networks)</a></li></ul></li><li><a href=#writing-sql-checks>Writing SQL Checks</a></li><li><a href=#troubleshooting>Troubleshooting</a></li></ul></nav></aside></main><footer><div><i>🧑‍💻</i>Built by and copyright<a href=https://querycanary.com target=_blank>QueryCanary</a><i>📅</i> 2025<i>🚀</i> <a href=https://github.com/QueryCanary/docs.querycanary.com target=_blank>GitHub</a></div><div><button class=btn><i>☀️</i><i>⁄</i><i>🌑</i></button></div></footer></div></div><div id=body-model-outer></div><script type=text/javascript src=/assets/js/docs.min.12ffdc25c0149ef34e761ee54587f2aae17affcb8375298ad2180851930cb142.js integrity></script></body></html>